import os
import shutil

# --- ì„¤ì • ---
# ê¸°ì¤€ì´ ë˜ëŠ” í•™ìŠµ ë°ì´í„° ë£¨íŠ¸ í´ë” ê²½ë¡œ
BASE_TRAIN_DIR = '/project/ahnailab/jys0207/CP/tjrgus5/train_renovate_v3' # ê³ ê°ë‹˜ì˜ CFG["ROOT"] ê°’

# ë‚¨ê²¨ì•¼ í•  í´ë˜ìŠ¤ ì´ë¦„ë“¤ (confusion_pairs ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ)
confusion_pairs = [
    ("ì•„ë°˜ë–¼_í•˜ì´ë¸Œë¦¬ë“œ_CN7_2021_2023", "ì•„ë°˜ë–¼_CN7_2021_2023"),
    ("GLC_í´ë˜ìŠ¤_X253_2020_2022", "GLC_í´ë˜ìŠ¤_X253_2023"),
    ("K8_2022_2024", "K8_í•˜ì´ë¸Œë¦¬ë“œ_2022_2024"),
    ("íŠ¸ë ˆì¼ë¸”ë ˆì´ì €_2023", "íŠ¸ë ˆì¼ë¸”ë ˆì´ì €_2021_2022"),
    ("K7_í”„ë¦¬ë¯¸ì–´_í•˜ì´ë¸Œë¦¬ë“œ_2020_2021", "K7_í”„ë¦¬ë¯¸ì–´_2020_2021"),
    ("4ì‹œë¦¬ì¦ˆ_G22_2021_2023", "4ì‹œë¦¬ì¦ˆ_G22_2024_2025"),
    ("ë”_ë„¥ìŠ¤íŠ¸_ìŠ¤íŒŒí¬_2016_2018", "ë”_ë‰´_ìŠ¤íŒŒí¬_2019_2022"),
    ("ë”_ë‰´_K5_3ì„¸ëŒ€_2024_2025", "ë”_ë‰´_K5_í•˜ì´ë¸Œë¦¬ë“œ_3ì„¸ëŒ€_2023_2025"),
    ("ë ˆì¸ì§€ë¡œë²„_4ì„¸ëŒ€_2014_2017", "ë ˆì¸ì§€ë¡œë²„_4ì„¸ëŒ€_2018_2022"),
    ("5008_2ì„¸ëŒ€_2021_2024", "3008_2ì„¸ëŒ€_2018_2023"),
    ("3008_2ì„¸ëŒ€_2018_2023", "5008_2ì„¸ëŒ€_2018_2019"),
    ("7ì‹œë¦¬ì¦ˆ_G11_2016_2018", "7ì‹œë¦¬ì¦ˆ_G11_2019_2022"),
    ("EQE_V295_2022_2024", "EQS_V297_2022_2023"),
    ("K5_3ì„¸ëŒ€_í•˜ì´ë¸Œë¦¬ë“œ_2020_2022", "K5_3ì„¸ëŒ€_2020_2023"),
    ("ë¼ë¸Œ4_5ì„¸ëŒ€_2019_2024", "RAV4_5ì„¸ëŒ€_2019_2024"), # ë™ì¼ í´ë˜ìŠ¤ëª… ìŒë„ í¬í•¨ë  ìˆ˜ ìˆìŒ (setìœ¼ë¡œ ì²˜ë¦¬)
    ("ë ˆì¸ì§€ë¡œë²„_ì´ë³´í¬_2ì„¸ëŒ€_2023_2024", "ë ˆì¸ì§€ë¡œë²„_ì´ë³´í¬_2ì„¸ëŒ€_2020_2022"),
    ("ìŠ¤íŒ…ì–´_ë§ˆì´ìŠ¤í„°_2021_2023", "ìŠ¤íŒ…ì–´_2018_2020"),
    ("3ì‹œë¦¬ì¦ˆ_GT_F34_2014_2021", "4ì‹œë¦¬ì¦ˆ_F32_2014_2020"),
    ("GLE_í´ë˜ìŠ¤_W166_2016_2018", "4ì‹œë¦¬ì¦ˆ_G22_2024_2025"), # ì´ì „ì— ë‚˜ì˜¨ í´ë˜ìŠ¤ë„ í¬í•¨ë  ìˆ˜ ìˆìŒ
    ("5008_2ì„¸ëŒ€_2018_2019", "5008_2ì„¸ëŒ€_2021_2024"),
    ("M5_F90_2018_2023", "5ì‹œë¦¬ì¦ˆ_G30_2017_2023"),
    ("ë”_ë‰´ìŠ¤í¬í‹°ì§€R_2014_2016", "5ì‹œë¦¬ì¦ˆ_G60_2024_2025"),
    ("6ì‹œë¦¬ì¦ˆ_GT_G32_2021_2024", "6ì‹œë¦¬ì¦ˆ_GT_G32_2018_2020"),
    ("ê·¸ëœë“œì¹´ë‹ˆë°œ_2006_2010", "6ì‹œë¦¬ì¦ˆ_GT_G32_2018_2020"),
    ("ë°•ìŠ¤í„°_718_2017_2024", "GLE_í´ë˜ìŠ¤_W167_2019_2024"),
    ("Q30_2017_2019", "911_992_2020_2024"),
    ("Q30_2017_2019", "G_í´ë˜ìŠ¤_W463b_2019_2025"),
    ("ì œë„¤ì‹œìŠ¤_DH_2014_2016", "G80_2017_2020"),
    ("ì¹´ì´ì—”_PO536_2019_2023", "G_í´ë˜ìŠ¤_W463b_2019_2025"),
    ("ë”_ì˜¬ë‰´G80_2021_2024", "K5_2ì„¸ëŒ€_2016_2018"),
    ("K5_3ì„¸ëŒ€_2020_2023", "K5_í•˜ì´ë¸Œë¦¬ë“œ_3ì„¸ëŒ€_2020_2023"),
    ("EQA_H243_2021_2024", "Q30_2017_2019"),
    ("ë‰´_ES300h_2013_2015", "Q50_2014_2017"),
    ("ìŠ¤í¬í‹°ì§€_4ì„¸ëŒ€_2016_2018", "Q5_FY_2021_2024"),
    ("7ì‹œë¦¬ì¦ˆ_F01_2009_2015", "Q7_4M_2020_2023"),
    ("7ì‹œë¦¬ì¦ˆ_F01_2009_2015", "X4_F26_2015_2018"),
    ("E_í´ë˜ìŠ¤_W213_2017_2020", "S_í´ë˜ìŠ¤_W222_2014_2020"),
    ("C_í´ë˜ìŠ¤_W205_2015_2021", "S_í´ë˜ìŠ¤_W222_2014_2020"),
    ("G70_2018_2020", "S_í´ë˜ìŠ¤_W223_2021_2025"),
    ("ë”_ë‰´_G70_2021_2025", "X1_F48_2020_2022"),
    ("X3_G01_2022_2024", "X4_G02_2022_2025"),
    ("X6_G06_2020_2023", "X6_G06_2024_2025"),
    ("XC90_2ì„¸ëŒ€_2020_2025", "XC90_2ì„¸ëŒ€_2017_2019"),
    ("XM3_2024", "XM3_2020_2023"),
    ("RAV4_5ì„¸ëŒ€_2019_2024", "ê·¸ëœë“œ_ì²´ë¡œí‚¤_WL_2021_2023"),
    ("ë‰´_A6_2012_2014", "ë‰´_A6_2015_2018"),
    ("ë‰´_G80_2025_2026", "ë‰´_GV80_2024_2025"),
    ("ê·¸ëœë“œì¹´ë‹ˆë°œ_2006_2010", "ë‰´_SM5_ì„í”„ë ˆì…˜_2008_2010"),
    ("ë‰´_QM6_2021_2023", "ë”_ë‰´_QM6_2020_2023"),
    ("SM6_2016_2020", "ë”_ë‰´_SM6_2021_2024"),
    ("F150_2004_2021", "ë”_ë‰´_ê·¸ëœë“œ_ìŠ¤íƒ€ë ‰ìŠ¤_2018_2021"),
    ("ê·¸ëœë“œ_ìŠ¤íƒ€ë ‰ìŠ¤_2016_2018", "ë”_ë‰´_ê·¸ëœë“œ_ìŠ¤íƒ€ë ‰ìŠ¤_2018_2021"),
    ("ë ‰ìŠ¤í„´_ìŠ¤í¬ì¸ _ì¹¸_2019_2020", "ë”_ë‰´_ë ‰ìŠ¤í„´_ìŠ¤í¬ì¸ _ì¹¸_2021_2025"),
    ("íŒŒë‚˜ë©”ë¼_2010_2016", "ë”_ë‰´_ì•„ë°˜ë–¼_2014_2016"),
    ("ì˜¬_ë‰´_ì¹´ë‹ˆë°œ_2015_2019", "ë”_ë‰´_ì¹´ë‹ˆë°œ_2019_2020"),
    ("íˆ¬ì‹¼_NX4_2021_2023", "ë”_ë‰´_íˆ¬ì‹¼_NX4_2023_2025"),
    ("ê¸€ë˜ë””ì—ì´í„°_JT_2020_2023", "ë­ê¸€ëŸ¬_JL_2018_2024"),
    ("ë ˆë‹ˆê²Œì´ë“œ_2015_2017", "ë ˆë‹ˆê²Œì´ë“œ_2019_2023"),
    ("XJ_8ì„¸ëŒ€_2010_2019", "ë¨¸ìŠ¤íƒ±_2015_2023"),
    ("ê·¸ëœì €_HG_2011_2014", "ë°•ìŠ¤í„°_718_2017_2024"),
    ("ë””_ì˜¬ë‰´ì‹¼íƒ€í˜_2024_2025", "ì‹¼íƒ€í˜_MX5_2024_2025"),
    ("SM7_ë‰´ì•„íŠ¸_2008_2011", "ì•„ë² ì˜¤_2012_2016"),
    ("ì˜¬_ë‰´_K7_2016_2019", "ì˜¬_ë‰´_K7_í•˜ì´ë¸Œë¦¬ë“œ_2017_2019"),
    ("ì¹´ë‹ˆë°œ_4ì„¸ëŒ€_2021", "ì¹´ë‹ˆë°œ_4ì„¸ëŒ€_2022_2023"),
    ("CLS_í´ë˜ìŠ¤_C257_2019_2023", "ì»¨í‹°ë„¨íƒˆ_GT_3ì„¸ëŒ€_2018_2023"),
    ("ë¦¬ì–¼_ë‰´_ì½œë¡œë¼ë„_2021_2022", "ì½œë¡œë¼ë„_2020_2020"),
    ("í‹°ë³¼ë¦¬_ì•„ë¨¸_2018_2019", "í‹°ë³¼ë¦¬_2015_2018"),
    ("íŒŒë‚˜ë©”ë¼_971_2017_2023", "íŒŒë‚˜ë©”ë¼_2010_2016"),
    ("All_New_XJ_2016_2019", "XJ_8ì„¸ëŒ€_2010_2019"),
    ("ê·¸ëœì €_HG_2015_2017", "ê·¸ëœì €_HG_2011_2014"),
    ("ì•„ë°˜ë–¼_CN7_2021_2023", "ë”_ë‰´_ì•„ë°˜ë–¼_CN7_2023_2025")
]

# confusion_pairsì— ìˆëŠ” ëª¨ë“  í´ë˜ìŠ¤ ì´ë¦„ì„ ì¤‘ë³µ ì—†ì´ setìœ¼ë¡œ ì¶”ì¶œ
classes_to_keep = set()
for pair in confusion_pairs:
    classes_to_keep.add(pair[0])
    classes_to_keep.add(pair[1])

# --- ì‹¤í–‰ í•¨ìˆ˜ ---
def delete_images_from_other_folders(base_dir, keep_folders_set):
    """
    base_dir ë‚´ì˜ ëª¨ë“  í•˜ìœ„ í´ë”ë¥¼ í™•ì¸í•˜ì—¬,
    keep_folders_setì— í¬í•¨ë˜ì§€ ì•Šì€ í´ë” ë‚´ì˜ ëª¨ë“  ì´ë¯¸ì§€ íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.
    í´ë” ìì²´ëŠ” ì‚­ì œí•˜ì§€ ì•Šê³ , ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì‚­ì œí•©ë‹ˆë‹¤.
    """
    deleted_files_count = 0
    kept_folders_count = 0
    processed_folders_count = 0

    print(f"ê¸°ì¤€ ë””ë ‰í† ë¦¬: {base_dir}")
    print(f"ì´ë¯¸ì§€ë¥¼ ë³´ì¡´í•  í´ë” ëª©ë¡ ({len(keep_folders_set)}ê°œ): {sorted(list(keep_folders_set))}\n")

    if not os.path.isdir(base_dir):
        print(f"âŒ ì˜¤ë¥˜: ê¸°ì¤€ ë””ë ‰í† ë¦¬ '{base_dir}'ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return

    for folder_name in os.listdir(base_dir):
        folder_path = os.path.join(base_dir, folder_name)
        if os.path.isdir(folder_path):
            processed_folders_count += 1
            if folder_name in keep_folders_set:
                print(f"ğŸŸ¢ ë³´ì¡´ ëŒ€ìƒ í´ë”: '{folder_name}' (ì´ë¯¸ì§€ ì‚­ì œ ì•ˆ í•¨)")
                kept_folders_count += 1
            else:
                print(f"ğŸŸ¡ ì‚­ì œ ëŒ€ìƒ í´ë” (ë‚´ë¶€ ì´ë¯¸ì§€): '{folder_name}'")
                current_folder_deleted_count = 0
                for filename in os.listdir(folder_path):
                    file_path = os.path.join(folder_path, filename)
                    if os.path.isfile(file_path) and filename.lower().endswith(('.png', '.jpg', '.jpeg')):
                        try:
                            os.remove(file_path)
                            # print(f"  - ì‚­ì œë¨: {filename}") # ë„ˆë¬´ ë§ì€ ë¡œê·¸ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì£¼ì„ ì²˜ë¦¬
                            deleted_files_count += 1
                            current_folder_deleted_count +=1
                        except Exception as e:
                            print(f"  - â—ï¸ ì˜¤ë¥˜: '{filename}' ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ - {e}")
                if current_folder_deleted_count > 0:
                    print(f"  â¡ï¸ '{folder_name}' í´ë”ì—ì„œ {current_folder_deleted_count}ê°œì˜ ì´ë¯¸ì§€ ì‚­ì œ ì™„ë£Œ.")
                else:
                    print(f"  â¡ï¸ '{folder_name}' í´ë”ì— ì‚­ì œí•  ì´ë¯¸ì§€ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.")
    
    print(f"\n--- ì‘ì—… ìš”ì•½ ---")
    print(f"ì´ ì²˜ë¦¬ëœ í´ë” ìˆ˜: {processed_folders_count}")
    print(f"ì´ë¯¸ì§€ ë³´ì¡´ëœ í´ë” ìˆ˜: {kept_folders_count}")
    print(f"ë‚´ë¶€ ì´ë¯¸ì§€ê°€ ì‚­ì œëœ í´ë” ìˆ˜: {processed_folders_count - kept_folders_count}")
    print(f"ì´ ì‚­ì œëœ ì´ë¯¸ì§€ íŒŒì¼ ìˆ˜: {deleted_files_count}")
    print(f"âœ… ì‘ì—… ì™„ë£Œ.")

# --- ì‹¤í–‰ ---
if __name__ == "__main__":
    print("="*50)
    print("ì´ë¯¸ì§€ ì‚­ì œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")
    print("ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì§€ì •ëœ 'ë³´ì¡´ ëŒ€ìƒ í´ë”' ì™¸ì˜ ëª¨ë“  í´ë”ì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.")
    print("ì‚­ì œëœ íŒŒì¼ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìœ¼ë‹ˆ, ì‹¤í–‰ ì „ ë°˜ë“œì‹œ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ì„¸ìš”!")
    print("="*50)
    
    # ì‚¬ìš©ì í™•ì¸ ì ˆì°¨
    confirm = input(f"\nê²½ê³ : '{BASE_TRAIN_DIR}' ê²½ë¡œì™€ ê·¸ í•˜ìœ„ í´ë”ì— ëŒ€í•´ ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤. \n"
                    f"'{', '.join(sorted(list(classes_to_keep))[:5])}...' ë“± ì´ {len(classes_to_keep)}ê°œ í´ë”ì˜ ì´ë¯¸ì§€ëŠ” ë³´ì¡´ë˜ê³ , \n"
                    f"ë‚˜ë¨¸ì§€ í´ë”ì˜ ì´ë¯¸ì§€ë“¤ì€ ì‚­ì œë©ë‹ˆë‹¤. \n"
                    "ì •ë§ë¡œ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (yes ì…ë ¥ ì‹œ ì§„í–‰): ")

    if confirm.lower() == 'yes':
        print("\nì´ë¯¸ì§€ ì‚­ì œ ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...")
        delete_images_from_other_folders(BASE_TRAIN_DIR, classes_to_keep)
    else:
        print("\nì‘ì—…ì´ ì‚¬ìš©ìì— ì˜í•´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")